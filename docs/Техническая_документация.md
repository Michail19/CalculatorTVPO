# Архитектура приложения

Приложение представляет собой монолитное desktop-приложение с графическим интерфейсом пользователя (GUI), построенным на библиотеке PyQt5. Архитектура условно можно разделить на следующие компоненты:

**GUI Layer (Слой интерфейса):** Классы `CurrencyCalculator` и `LockedLineEdit`. Отвечают за отрисовку виджетов, обработку пользовательского ввода и отображение данных.

**Business Logic Layer (Слой бизнес-логики):** Методы класса `CurrencyCalculator` (`on_button_click`, `on_value_change`, `update_combo_availability` и др.). Инкапсулируют логику вычислений, конвертации и управления состоянием интерфейса.

**Data Access Layer (Слой доступа к данным):** Метод `get_rates`. Отвечает за получение внешних данных (курсов валют) через HTTP-запрос к API.

Основной паттерн взаимодействия — **Model-View-Controller (MVC)**, где:

* **Model:** Данные о курсах валют (`self.rates`) и текущие значения в полях ввода.
* **View:** Виджеты PyQt (`QLineEdit`, `QComboBox`, `QPushButton`).
* **Controller:** Класс `CurrencyCalculator`, который обрабатывает события от View и обновляет Model и View.

---

# Структура исходного кода

**main.py:** Единственный файл проекта, содержащий всю логику.

* Класс `LockedLineEdit`: Кастомный класс-потомок QLineEdit. Переопределяет метод keyPressEvent для фильтрации вводимых пользователем символов. Разрешает ввод только цифр, основных арифметических операторов, запятой, точки и управляющих клавиш.
* Класс `CurrencyCalculator`: Основной класс приложения, потомок QWidget.
* `__init__`: Инициализирует UI, загружает курсы валют, создает и связывает все виджеты.
* `get_rates`: Выполняет HTTP-запрос к API api.currencylayer.com для получения актуальных курсов валют. В случае ошибки использует фиксированный набор курсов.
* `on_value_change`: Центральный метод. Вызывается при изменении текста в любом из полей ввода. Отвечает за конвертацию валют и синхронизацию значений между полями.
* `on_button_click`: Обрабатывает нажатия всех кнопок калькулятора. Выполняет вычисления, очистку, удаление символов.
* `on_currency_selection_change` / `on_currency_change`: Обрабатывают смену выбранной валюты в выпадающих списках, запрещают выбор одинаковых валют и запускают пересчет сумм.
* `update_combo_availability`: Логика отключения уже выбранных в других строках валют в выпадающих списках.
* `update_button_states`: Интеллектуальное отключение кнопок операторов и точки, если их ввод на текущей позиции выражения является некорректным (например, запрет двух точек подряд в числе).

---

# Перечень используемых технологий, библиотек и лицензий

* Язык программирования: Python 3.9+
* GUI Framework: PyQt5 v5.15.9 (GPL v3 или коммерческая лицензия)
* HTTP-клиент: библиотека requests (Apache License 2.0)
* API данных: Currencylayer API (используется бесплатный план с ограничениями)
* Иконки: Не используются, только текстовые кнопки.
* Важное примечание по лицензиям: Использование PyQt5 в проекте подразумевает соблюдение условий лицензии GPL v3, что требует раскрытия исходного кода производного продукта. Для проприетарного ПО следует рассмотреть возможность использования Qt под коммерческой лицензией или использование фреймворка PySide6 (имеет схожий API и лицензируется under LGPL).

---

# Сборка и развертывание

Для создания исполняемого файла (.exe) можно использовать утилиту pyinstaller.

* Установите pyinstaller: `pip install pyinstaller`
* Перейдите в папку с main.py
* Выполните команду:

```bash
pyinstaller --onefile --windowed --name FinanceKal main.py
```

* `--onefile` — собрать в один исполняемый файл.
* `--windowed` — не показывать консольное окно при запуске.
* `--name` — задать имя выходного файла.

Исполняемый файл будет находиться в папке **dist**.

